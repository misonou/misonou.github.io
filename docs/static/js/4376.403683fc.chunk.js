"use strict";(self.webpackChunkbrewjs_for_react_router_example=self.webpackChunkbrewjs_for_react_router_example||[]).push([[4376],{4376:function(e,r,s){s.r(r);var n=s(2556);function t(e){const r=Object.assign({h1:"h1",p:"p",h2:"h2",pre:"pre",code:"code",h3:"h3",h4:"h4",del:"del",ul:"ul",li:"li",a:"a",blockquote:"blockquote",strong:"strong"},e.components),{Module:s,ImportHint:t,MemberList:c,VersionTimeline:a,Badge:d}=r;return d||i("Badge",!1),d.Version||i("Badge.Version",!0),t||i("ImportHint",!0),c||i("MemberList",!0),s||i("Module",!0),a||i("VersionTimeline",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s,{name:"brew-js/util"}),"\n",(0,n.jsx)(r.h1,{children:"createObjectStorage"}),"\n",(0,n.jsx)(r.p,{children:"Creates a storage that enables serializing and deserializing complex object structures."}),"\n",(0,n.jsx)(r.h2,{children:"Syntax"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"createObjectStorage(storage, key)\n"})}),"\n",(0,n.jsx)(t,{name:"createObjectStorage",module:"brew-js/util/storage",global:"brew.createObjectStorage"}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"storage"})}),(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"window.sessionStorage"})," or ",(0,n.jsx)(r.code,{children:"window.localStorage"})," object."]}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"Key used for saving data to backing storage."})]}),"\n",(0,n.jsx)(r.h2,{children:"Object and circular references"}),"\n",(0,n.jsx)(r.p,{children:"Object references are maintained and circular references are supported."}),"\n",(0,n.jsxs)(r.h2,{children:["Custom objects ",(0,n.jsx)(r.del,{children:"v0.6.9"})]}),"\n",(0,n.jsx)(r.p,{children:"Custom objects (object with non-trivial prototypes) can be deserialized automatically if its constructor is registered."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"class Bar {\r\n    constructor(data) {\r\n        if (data !== undefined) {\r\n            this.fromJSON(data);\r\n        }\r\n    }\r\n    fromJSON(data) {\r\n        /* ... */\r\n    }\r\n    toJSON() {\r\n        /* ... */\r\n    }\r\n}\r\nconst store = createObjectStorage(window.localStorage, 'myStorage');\r\nstore.registerType('Bar', Bar, (target, data) => target.fromJSON(data));\n"})}),"\n",(0,n.jsx)(r.p,{children:"During deserialization, object will be constructed with:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"deserialized data as the first argument;"}),"\n",(0,n.jsx)(r.li,{children:"or with no argument when data is not fully deserialized due to circular references."}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["In the latter case, callback passed to ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.registerType()"})})," will be invoked when data is fully deserialized."]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"Note that derived types must be registered explicitly."}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["Type registration is preferred over ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.revive()"})})," as the latter only allows custom types on object directly set on storage;\r\nand it may also break references."]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{children:"Limitations"}),"\n",(0,n.jsx)(r.p,{children:"All limitations with native JSON serialization applies (except for circular references):"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Properties with symbols as keys are not serialized"}),"\n",(0,n.jsx)(r.li,{children:"Properties with functions as values are not serialized"}),"\n",(0,n.jsxs)(r.li,{children:["Non-plain object is converted to plain object by enumerating its properties or value returned by ",(0,n.jsx)(r.code,{children:"toJSON()"})," if it is defined on the object,\r\nexcept (since v0.6.9) when the constructor is registered through ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.registerType()"})})]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"In addition, properties with these values are also ignored, due to commonly large amount of data:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"Blob"})," objects"]}),"\n",(0,n.jsx)(r.li,{children:"DOM nodes, i.e. elements and text nodes"}),"\n",(0,n.jsxs)(r.li,{children:["the ",(0,n.jsx)(r.code,{children:"window"})," object"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"It is recommended to only store strings, numbers and booleans values, as well as objects and arrays containing only these values."}),"\n"]}),"\n",(0,n.jsx)(r.h2,{children:"Persisting nested object"}),"\n",(0,n.jsxs)(r.p,{children:["Any object deserialized from object storage can be passed to ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.persist()"})}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"const storage = app.historyStorage.current;\r\nconst data = storage.get('data');\r\nconst nested = data.obj;\r\n\r\nnested.a = 1;\r\nstorage.persist(nested); // storage will be updated\n"})}),"\n",(0,n.jsx)(r.h2,{children:"ObjectStorage interface"}),"\n",(0,n.jsx)(c,{i:"ObjectStorage",im:["keys()","has()","revive()","get()","set()","persist()","persistAll()","delete()","clear()","registerType()"]}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.clear()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"clear()\n"})}),"\n",(0,n.jsx)(r.p,{children:"Clears all data present in storage."}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.delete()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"delete(key)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Removes data from storage."}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"A key associated to specific data."})]}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.get()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"get(key)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Gets data from the storage."}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"A key associated to specific data."})]}),"\n",(0,n.jsxs)(r.h3,{children:[(0,n.jsx)(r.code,{children:"ObjectStorage.has()"})," ",(0,n.jsx)(d.Version,{})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"has(key)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Gets whether the specified key is present in storage."}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsx)("dl",{children:(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})})}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.keys()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"keys()\n"})}),"\n",(0,n.jsx)(r.p,{children:"Gets all keys present in storage."}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.persist()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"persist(obj)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Marks object as dirty and updates backing storage asynchronously."}),"\n",(0,n.jsxs)(r.p,{children:["It has no effects for objects not restored by ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.get"})})," or ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.revive"})}),",\r\nor persisted by ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.set"})}),"."]}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"obj"})}),(0,n.jsx)(r.p,{children:"Object needed to have updates persisted."})]}),"\n",(0,n.jsxs)(r.h3,{children:[(0,n.jsx)(r.code,{children:"ObjectStorage.persistAll()"})," ",(0,n.jsx)(d.Version,{})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"persistAll()\n"})}),"\n",(0,n.jsx)(r.p,{children:"Marks all living objects as dirty and updates backing storage asynchronously."}),"\n",(0,n.jsxs)(r.h3,{children:[(0,n.jsx)(r.code,{children:"ObjectStorage.registerType()"})," ",(0,n.jsx)(d.Version,{})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"registerType(key, ctor, callback)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Enables deserialization of object as custom class."}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"Note that the constructor should instantiate with or without deserialized data, depending on whether data is fully deserialized.\r\nAlso inherited classes must be registered explicitly."}),"\n"]}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"A key identifying the class. It should be unique and contain only alphanumeric characters."}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"ctor"})}),(0,n.jsx)(r.p,{children:"A constructible function or class."}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"callback"})}),(0,n.jsx)(r.p,{children:"A callback to initialize object with deserialized data when data is not available during instantiation."})]}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.revive()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"revive(key, ctor)\r\nrevive(key, callback)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Restores non-primitive objects from storage."}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"It will replace previous object of the same key if it was not stored with its constructor registered.\r\nReferences to previous object are untouched, meaning that they will no longer point to the returned object."}),"\n"]}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"A key associated to specific data."}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"ctor"})}),(0,n.jsxs)(r.p,{children:["Constructor registered with ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.registerType"})}),"."]}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"callback"})}),(0,n.jsx)(r.p,{children:"Callback to construct result object, receiving deserialized JSON data as the first argument."})]}),"\n",(0,n.jsx)(r.h3,{children:(0,n.jsx)(r.code,{children:"ObjectStorage.set()"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-javascript",children:"set(key, value)\n"})}),"\n",(0,n.jsx)(r.p,{children:"Persists data to storage."}),"\n",(0,n.jsxs)(r.p,{children:["Objects are serialized to JSON notation, therefore it has the same limitations as ",(0,n.jsx)(r.code,{children:"JSON.stringify"})," when\r\nstoring non-primitive objects. This can partially overcome by having ",(0,n.jsx)(r.code,{children:"toJSON"})," method on objects to serialize\r\nas JSON object structures and be later recovered by ",(0,n.jsx)(r.a,{href:":",children:(0,n.jsx)(r.code,{children:"ObjectStorage.revive"})}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["Circular references are supported and are maintained when deserialized back from storage.\r\nOn the other hand, certain built-in objects are ignored, such as ",(0,n.jsx)(r.code,{children:"Blob"})," data, DOM elements and the ",(0,n.jsx)(r.code,{children:"window"})," object."]}),"\n",(0,n.jsx)(r.h3,{children:"Parameters"}),"\n",(0,n.jsxs)("dl",{children:[(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"key"})}),(0,n.jsx)(r.p,{children:"A key associated to specific data."}),(0,n.jsx)(r.h4,{children:(0,n.jsx)(r.code,{children:"value"})}),(0,n.jsx)(r.p,{children:"Data to be stored."})]}),"\n",(0,n.jsx)(r.h2,{children:"Version information"}),"\n",(0,n.jsx)(a,{module:"brew-js",children:(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"0.5.0"})," Introduced"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"0.5.2"})," ",(0,n.jsx)(r.code,{children:"ObjectStorage.has()"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"0.5.13"})," ",(0,n.jsx)(r.code,{children:"ObjectStorage.persistAll()"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"0.6.9"})," ",(0,n.jsx)(r.code,{children:"ObjectStorage.registerType()"})]}),"\n"]})})]})}function i(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}r.default=function(e={}){const{wrapper:r}=e.components||{};return r?(0,n.jsx)(r,Object.assign({},e,{children:(0,n.jsx)(t,e)})):t(e)}}}]);