"use strict";(self.webpackChunkbrewjs_for_react_router_example=self.webpackChunkbrewjs_for_react_router_example||[]).push([[5857],{5857:function(n,e,r){r.r(e),r.d(e,{default:function(){return P}});var t=r(2556),o=r(4519),c=r(9239),i=r(7749),a=function(){return a=Object.assign||function(n){for(var e,r=1,t=arguments.length;r<t;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},a.apply(this,arguments)},s=function(n,e,r,t){return new(r||(r=Promise))((function(o,c){function i(n){try{s(t.next(n))}catch(e){c(e)}}function a(n){try{s(t.throw(n))}catch(e){c(e)}}function s(n){var e;n.done?o(n.value):(e=n.value,e instanceof r?e:new r((function(n){n(e)}))).then(i,a)}s((t=t.apply(n,e||[])).next())}))},l=function(n,e){var r,t,o,c,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,t=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(n,i)}catch(a){c=[6,a],t=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};function u(){var n=this,e=(0,o.useRef)(null),r=(0,o.useState)(!1),u=r[0],d=r[1];return(0,o.useEffect)((function(){(0,c.wv)(e.current,d)}),[]),(0,t.jsx)("div",a({ref:e},{children:(0,t.jsx)("button",a({disabled:u,onClick:function(e){(0,c.eH)(e.currentTarget,(function(){return s(n,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,(0,i.gw)(3e3)];case 1:return n.sent(),[2]}}))}))}))}},{children:u?"Wait 3 seconds":"Start"}))}))}var d='import { useEffect, useRef, useState } from "react";\r\nimport { runAsync, subscribeAsync } from "zeta-dom/domLock";\r\nimport { delay } from "zeta-dom/util";\r\n\r\nfunction doLongOperation() {\r\n    return delay(3000);\r\n}\r\n\r\nexport default function Component() {\r\n    const container = useRef<HTMLDivElement>(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // listen operations registered by\r\n        // runAsync or notifyAsync under this element\r\n        subscribeAsync(container.current!, setLoading);\r\n    }, []);\r\n\r\n    return (\r\n        <div ref={container}>\r\n            <button\r\n                disabled={loading}\r\n                onClick={(e) => {\r\n                    runAsync(e.currentTarget, async () => {\r\n                        await doLongOperation();\r\n                    });\r\n                }}>\r\n                {loading ? \'Wait 3 seconds\' : \'Start\'}\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n',f=r(2764);function h(){return(0,t.jsx)(f.iV,{component:u,source:{tsx:d}})}var p=r(5776),b=r(9343),m=function(){return m=Object.assign||function(n){for(var e,r=1,t=arguments.length;r<t;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},m.apply(this,arguments)},x=function(n,e,r,t){return new(r||(r=Promise))((function(o,c){function i(n){try{s(t.next(n))}catch(e){c(e)}}function a(n){try{s(t.throw(n))}catch(e){c(e)}}function s(n){var e;n.done?o(n.value):(e=n.value,e instanceof r?e:new r((function(n){n(e)}))).then(i,a)}s((t=t.apply(n,e||[])).next())}))},y=function(n,e){var r,t,o,c,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,t=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(n,i)}catch(a){c=[6,a],t=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};function g(n){return x(this,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return n.addEventListener("abort",(function(){(0,b.qR)("Operation cancelled")})),[4,(0,i.gw)(3e3)];case 1:return e.sent(),n.aborted||(0,b.qR)("Operation completed"),[2]}}))}))}function j(){var n=(0,o.useRef)(null),e=(0,o.useState)(!1),r=e[0],i=e[1];return(0,o.useEffect)((function(){(0,c.wv)(n.current,i)}),[]),(0,t.jsx)("div",m({ref:n},{children:r?(0,t.jsx)("button",m({onClick:function(){(0,c.Ei)(n.current)}},{children:"Cancel"})):(0,t.jsx)("button",m({onClick:function(n){var e=this,r=(0,c.eH)(n.currentTarget,(function(n){var r=n.signal;return x(e,void 0,void 0,(function(){return y(this,(function(n){switch(n.label){case 0:return[4,g(r)];case 1:return n.sent(),[2]}}))}))}));(0,c.dR)(n.currentTarget,r,(function(){return x(e,void 0,void 0,(function(){return y(this,(function(n){switch(n.label){case 0:return[4,(0,b.BB)("Confirm to cancel operation?")];case 1:if(!n.sent())throw"";return[2]}}))}))}))}},{children:"Start"}))}))}var v="import { useEffect, useRef, useState } from \"react\";\r\nimport { openAlert, openConfirm } from \"src/components/main\";\r\nimport { cancelLock, lock, runAsync, subscribeAsync } from \"zeta-dom/domLock\";\r\nimport { delay } from \"zeta-dom/util\";\r\n\r\nasync function doLongOperation(signal: AbortSignal) {\r\n    signal.addEventListener('abort', () => {\r\n        openAlert('Operation cancelled');\r\n    });\r\n    await delay(3000);\r\n    if (!signal.aborted) {\r\n        openAlert('Operation completed');\r\n    }\r\n}\r\n\r\nexport default function Component() {\r\n    const container = useRef<HTMLDivElement>(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        subscribeAsync(container.current!, setLoading);\r\n    }, []);\r\n\r\n    return (\r\n        <div ref={container}>\r\n            {loading ?\r\n                <button onClick={cancel}>Cancel</button> :\r\n                <button onClick={start}>Start</button>}\r\n        </div>\r\n    );\r\n\r\n    function start(e: React.UIEvent<HTMLElement>) {\r\n        const promise = runAsync(e.currentTarget, async ({ signal }) => {\r\n            await doLongOperation(signal);\r\n        });\r\n\r\n        // acquire lock so that cancellation request can be handled\r\n        lock(e.currentTarget, promise, async () => {\r\n            // return normally to accept cancellation or\r\n            // throw to reject cancellation\r\n            if (!await openConfirm('Confirm to cancel operation?')) {\r\n                throw '';\r\n            }\r\n        });\r\n    }\r\n\r\n    function cancel() {\r\n        // request cancellation of operations registered by\r\n        // runAsync or notifyAsync under this element\r\n        cancelLock(container.current!);\r\n    }\r\n}\r\n";function w(){return(0,t.jsx)(f.iV,{component:j,source:{tsx:v}})}var k=r(3967),A=function(){return A=Object.assign||function(n){for(var e,r=1,t=arguments.length;r<t;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},A.apply(this,arguments)},L=function(n,e,r,t){return new(r||(r=Promise))((function(o,c){function i(n){try{s(t.next(n))}catch(e){c(e)}}function a(n){try{s(t.throw(n))}catch(e){c(e)}}function s(n){var e;n.done?o(n.value):(e=n.value,e instanceof r?e:new r((function(n){n(e)}))).then(i,a)}s((t=t.apply(n,e||[])).next())}))},S=function(n,e){var r,t,o,c,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,t=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(n,i)}catch(a){c=[6,a],t=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};function C(){return L(this,void 0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,(0,i.gw)(1e3)];case 1:throw n.sent(),new Error("Error occurred")}}))}))}function E(n){var e=this,r=n.console,i=(0,o.useRef)(null),a=(0,o.useState)(!1),s=a[0],l=a[1];return(0,o.useEffect)((function(){return(0,c.wv)(i.current,l),k.ZP.on(i.current,"error",(function(n){r.error(n.error),n.handled()}))}),[]),(0,t.jsx)("div",A({ref:i},{children:(0,t.jsx)("button",A({disabled:s,onClick:function(n){(0,c.eH)(n.currentTarget,(function(){return L(e,void 0,void 0,(function(){return S(this,(function(n){switch(n.label){case 0:return[4,C()];case 1:return n.sent(),[2]}}))}))}))}},{children:"Start"}))}))}var O='import { useEffect, useRef, useState } from "react";\r\nimport { DemoComponentProps } from "src/components/docs";\r\nimport dom from "zeta-dom/dom";\r\nimport { runAsync, subscribeAsync } from "zeta-dom/domLock";\r\nimport { delay } from "zeta-dom/util";\r\n\r\nasync function doLongOperation() {\r\n    await delay(1000);\r\n    throw new Error(\'Error occurred\');\r\n}\r\n\r\nexport default function Component({ console }: DemoComponentProps) {\r\n    const container = useRef<HTMLDivElement>(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        subscribeAsync(container.current!, setLoading);\r\n        // handle error thrown from operations under container element\r\n        return dom.on(container.current!, \'error\', e => {\r\n            console.error(e.error);\r\n            e.handled();\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <div ref={container}>\r\n            <button\r\n                disabled={loading}\r\n                onClick={(e) => {\r\n                    runAsync(e.currentTarget, async () => {\r\n                        await doLongOperation();\r\n                    });\r\n                }}>\r\n                Start\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n';function T(){return(0,t.jsx)(f.iV,{component:E,source:{tsx:O},console:!0})}function q(n){const e=Object.assign({h1:"h1",p:"p",a:"a",code:"code",pre:"pre",h2:"h2",blockquote:"blockquote",ul:"ul",li:"li"},n.components),{Module:r}=e;return r||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Module",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r,{name:"zeta-dom/domLock"}),"\n",(0,t.jsx)(e.h1,{children:"Handling user actions"}),"\n",(0,t.jsxs)(e.p,{children:["Below is an example showing how to register and listen asynchronous operations with the\r\nuse of ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"runAsync"})})," and ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"subscribeAsync"})}),"."]}),"\n",(0,t.jsx)(h,{}),"\n",(0,t.jsxs)(e.p,{children:["For older version where ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"runAsync"})})," is unavailable, use ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"notifyAsync"})}),"."]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const promise = doLongOperation();\r\nnotifyAsync(element, promise);\n"})}),"\n",(0,t.jsx)(e.h2,{children:"Wrapper for event handler"}),"\n",(0,t.jsxs)(e.p,{children:["For common application like clicking button, the ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"handleUserAction"})})," function can be used."]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-tsx",children:"function Button(props) {\r\n    return (\r\n        <button {...props} onClick={handleUserAction(props.onClick)} />\r\n    );\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{children:"Background operations"}),"\n",(0,t.jsxs)(e.p,{children:["In the same way background operations can be notified. However when using ",(0,t.jsx)(e.code,{children:"zeta-dom-react"}),", background\r\noperation can be better handled by ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"useAsync"})})," hook."]}),"\n",(0,t.jsx)(e.h2,{children:"Loading effect"}),"\n",(0,t.jsx)(p.Z,{}),"\n",(0,t.jsx)(e.h2,{children:"Cancellation"}),"\n",(0,t.jsxs)(e.p,{children:["Cancellation can be requested by calling ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"cancelLock"})})," is called on target element or any ancestors."]}),"\n",(0,t.jsx)(e.p,{children:"For example, when using Brew's router, cancellation is requested when user is trying to navigate\r\nwithin the single-paged app."}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["By default, operation registered by ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"notifyAsync"})})," or ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"runAsync"})})," is consider cancellable without confirmation."]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-tsx",children:"runAsync(currentTarget, ({ signal }) => {\r\n    // pass AbortSignal object to native API such as fetch\r\n    return fetch('...', { signal, /* ... */ });\r\n});\n"})}),"\n",(0,t.jsx)(e.p,{children:"For older version, supply callback as thrid argument as follow."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const promise = doLongOperation();\r\nnotifyAsync(element, promise, () => {\r\n    // callback will be called when cancellation is accepted\r\n    /* ... */\r\n});\n"})}),"\n",(0,t.jsx)(e.h2,{children:"Preventing cancellation"}),"\n",(0,t.jsxs)(e.p,{children:["To prevent cancellation at all, use ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"lock"})})," without callbacks:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const promise = doLongOperation();\r\nlock(element, promise); // locked until resolved\n"})}),"\n",(0,t.jsx)(e.p,{children:"or"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const unlock = lock(element);\r\ndoLongOperation().then(() => {\r\n    unlock();\r\n});\n"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Note that locks on an element will be forcibly cancelled if the element is detached."}),"\n"]}),"\n",(0,t.jsx)(e.h2,{children:"Asking confirmation for cancellation"}),"\n",(0,t.jsxs)(e.p,{children:["To prompt user for cancellation, supply callback to ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"lock"})}),":"]}),"\n",(0,t.jsx)(w,{}),"\n",(0,t.jsx)(e.h2,{children:"Error handling"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"runAsync"})})," and ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"notifyAsync"})})," will emit ",(0,t.jsx)(e.code,{children:"error"})," event when the promise has rejected."]}),"\n",(0,t.jsx)(T,{}),"\n",(0,t.jsxs)(e.p,{children:["When using ",(0,t.jsx)(e.code,{children:"zeta-dom-react"}),", more sophisticated handling can be done, see ",(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"useErrorHandler"})}),"."]}),"\n",(0,t.jsx)(e.h2,{children:"See also"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"/docs/dom/prevent-leave",children:"Preventing from leaving"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"cancelLock"})})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"notifyAsync"})})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"runAsync"})})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"useErrorHandler"})})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:":",children:(0,t.jsx)(e.code,{children:"LoadingStateMixin"})})}),"\n"]})]})}var P=function(n={}){const{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(q,n)})):q(n)}},5776:function(n,e,r){r.d(e,{Z:function(){return b}});var t=r(2556),o=r(6225),c=r(8252),i=r(1266),a=r(9239),s=r(7749),l=function(){return l=Object.assign||function(n){for(var e,r=1,t=arguments.length;r<t;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},l.apply(this,arguments)};function u(){return(0,s.gw)(3e3)}function d(){var n=(0,o.vS)(),e=(0,i.hy)(n,"loading");return(0,t.jsx)("div",l({id:"demo-wujq5"},c.Z.use(n),{children:e?(0,t.jsx)("button",l({onClick:function(n){return(0,a.Ei)(n.currentTarget.parentElement)}},{children:"Cancel"})):(0,t.jsx)("button",l({onClick:function(n){return(0,a.eH)(n.currentTarget,u)}},{children:"Start"}))}))}var f='import { Mixin, useLoadingStateMixin } from "brew-js-react";\r\nimport { useObservableProperty } from "zeta-dom-react";\r\nimport { cancelLock, runAsync } from "zeta-dom/domLock";\r\nimport { delay } from "zeta-dom/util";\r\n\r\nfunction doLongOperation() {\r\n    return delay(3000);\r\n}\r\n\r\nexport default function Component() {\r\n    const loadingState = useLoadingStateMixin();\r\n    const loading = useObservableProperty(loadingState, \'loading\');\r\n    return (\r\n        <div id="demo-wujq5" {...Mixin.use(loadingState)}>\r\n            {loading ?\r\n                <button onClick={e => cancelLock(e.currentTarget.parentElement!)}>\r\n                    Cancel\r\n                </button> :\r\n                <button onClick={e => runAsync(e.currentTarget, doLongOperation)}>\r\n                    Start\r\n                </button>}\r\n        </div>\r\n    );\r\n}\r\n',h="#demo-wujq5.loading:before {\r\n    position: absolute;\r\n    z-index: 1;\r\n    content: '';\r\n    top: 0;\r\n    left: 0;\r\n    border-bottom: 4px solid var(--color-highlight);\r\n    animation: loading-bar 1000s;\r\n}\r\n\r\n#demo-wujq5.loading-complete:before {\r\n    animation: none;\r\n    transition: right 0.2s, opacity 0.2s ease-out;\r\n    right: 0;\r\n    opacity: 0;\r\n}\r\n",p=r(2764);function b(){return(0,t.jsx)(p.iV,{component:d,source:{tsx:f,css:h},title:"Loading effect using React mixin"})}}}]);