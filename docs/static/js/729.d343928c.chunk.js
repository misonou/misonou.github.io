"use strict";(self.webpackChunkbrewjs_for_react_router_example=self.webpackChunkbrewjs_for_react_router_example||[]).push([[729],{729:function(e,n,s){s.r(n);var r=s(2556);function t(e){const n=Object.assign({h1:"h1",p:"p",ol:"ol",li:"li",code:"code",pre:"pre",h2:"h2",h3:"h3",h4:"h4",ul:"ul",strong:"strong"},e.components),{Module:s,ImportHint:t,VersionTimeline:o,Badge:c}=n;return c||i("Badge",!1),c.Deprecated||i("Badge.Deprecated",!0),c.Optional||i("Badge.Optional",!0),c.Version||i("Badge.Version",!0),t||i("ImportHint",!0),s||i("Module",!0),o||i("VersionTimeline",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{name:"zeta-dom-react"}),"\n",(0,r.jsx)(n.h1,{children:"useSingleton"}),"\n",(0,r.jsx)(n.p,{children:"Makes sure side effects from object creation are properly cleaned up."}),"\n",(0,r.jsx)(n.p,{children:"In React development strict mode, additional diagnotics are done by executing component and hook repeatedly,\r\nmeaning that"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useState"})," or ",(0,r.jsx)(n.code,{children:"useMemo"})," will create two copies of objects while one being discarded in each run,\r\nand"]}),"\n",(0,r.jsxs)(n.li,{children:["cleanup function returned to ",(0,r.jsx)(n.code,{children:"useEffect"})," will be invoked once before actual use."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This can cause issues when"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"there are side effects from object creation, and"}),"\n",(0,r.jsxs)(n.li,{children:["cleaning up using ",(0,r.jsx)(n.code,{children:"useEffect"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This hook gurantees that, cleanup functions are always executed after object is replaced or parent component is unmounted,\r\nand any discarded objects are also disposed."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const singleton = useState(factory)[0];\r\n// factory will be called twice in development strict mode\r\n// where the first singleton instance returned is discarded after second execution\r\nuseEffect(() => {\r\n    return () => {\r\n        // the `dispose` method will actually be called\r\n        // when component is being first mounted in development strict mode,\r\n        // so the internal state will be invalid when component is rerendered.\r\n        singleton.dispose();\r\n    };\r\n}, [singleton]);\n"})}),"\n",(0,r.jsx)(n.p,{children:"Instead the following will be safe in development strict mode:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const singleton = useSingleton(factory, []);\n"})}),"\n",(0,r.jsx)(n.h2,{children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"useSingleton(factory, deps)\r\nuseSingleton(factory, deps, onDispose)\r\nuseSingleton(factory)                  // deprecated\r\nuseSingleton(factory, onDispose)       // deprecated\r\nuseSingleton(target)                   // deprecated\r\nuseSingleton(target, onDispose)        // deprecated\n"})}),"\n",(0,r.jsx)(t,{name:"useSingleton",module:"zeta-dom-react",require:"useSingleton",global:"zeta.react.useSingleton"}),"\n",(0,r.jsx)(n.h3,{children:"Parameters"}),"\n",(0,r.jsxs)("dl",{children:[(0,r.jsx)(n.h4,{children:(0,r.jsx)(n.code,{children:"factory"})}),(0,r.jsx)(n.p,{children:"A callback that return an object."}),(0,r.jsxs)(n.h4,{children:[(0,r.jsx)(n.code,{children:"deps"})," ",(0,r.jsx)(c.Version,{})]}),(0,r.jsx)(n.p,{children:"Construct a new object when any values in the list changes."}),(0,r.jsxs)(n.h4,{children:[(0,r.jsx)(n.code,{children:"target"})," ",(0,r.jsx)(c.Version,{})," ",(0,r.jsx)(c.Deprecated,{})]}),(0,r.jsx)(n.p,{children:"A singleton object."}),(0,r.jsxs)(n.h4,{children:[(0,r.jsx)(n.code,{children:"onDispose"})," ",(0,r.jsx)(c.Optional,{})]}),(0,r.jsx)(n.p,{children:"Callback to be invoked when target object is being disposed.\r\nThe callback will receive the target object and a flag indicating whether it is actually consumed by the component."}),(0,r.jsxs)(n.p,{children:["If unspecified, the ",(0,r.jsx)(n.code,{children:"dispose"})," method on the target object will be invoked if there exists such method."]})]}),"\n",(0,r.jsx)(n.h3,{children:"Return value"}),"\n",(0,r.jsxs)(n.p,{children:["The object returned from the ",(0,r.jsx)(n.code,{children:"factory"})," callback."]}),"\n",(0,r.jsx)(n.h2,{children:"Version information"}),"\n",(0,r.jsx)(o,{module:"zeta-dom-react",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"0.4.6"})," Introduced"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"0.4.14"})," ",(0,r.jsx)(n.code,{children:"target"})," parameter"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"0.5.9"})," ",(0,r.jsx)(n.code,{children:"deps"})," parameter"]}),"\n"]})})]})}function i(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}n.default=function(e={}){const{wrapper:n}=e.components||{};return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(t,e)})):t(e)}}}]);